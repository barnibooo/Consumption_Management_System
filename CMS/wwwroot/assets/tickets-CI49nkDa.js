import{l as M,j as e,r as n,R as he,n as m,e as i,C as xe,L as me,T as c,f as fe}from"./index-DW2RJM_L.js";import{S as O,A as ge,L as V,a as q,D as U}from"./DeleteOutlineOutlined-BKd7d45w.js";import{S as pe}from"./Send-COCKoMwb.js";import{c as je}from"./AuthService-4k0KJGyh.js";import{r as be}from"./RefreshService-CkshRjuf.js";import{I as d,p as z,N as ye}from"./Navbar-BavKYrQN.js";import{S as $,A as K}from"./Snackbar-BoVZBEip.js";import{C as k}from"./Card-B3esABxY.js";import{C as S}from"./CardHeader-D3kGs5sr.js";import{T as W}from"./TextField-B_SISyHb.js";import{C as B}from"./CardActions-CR4ggJcr.js";import{B as Ce}from"./Button-L5L-jXUd.js";import{C as G}from"./CardMedia-Datqsumh.js";import{C as J}from"./CardContent-BSubk8B7.js";import"./Select-CssrkscS.js";const Y=M(e.jsx("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4l-3.87 7H8.53L4.27 2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7z"}),"AddShoppingCartOutlined"),Ie=M(e.jsx("path",{d:"M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2m-2-1.46c-1.19.69-2 1.99-2 3.46s.81 2.77 2 3.46V18H4v-2.54c1.19-.69 2-1.99 2-3.46 0-1.48-.8-2.77-1.99-3.46L4 6h16zM11 15h2v2h-2zm0-4h2v2h-2zm0-4h2v2h-2z"}),"ConfirmationNumberOutlined"),ve=M(e.jsx("path",{d:"M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38S5.76 9.8 4.01 9.12L4 7h6V5c0-.28.22-.5.5-.5m0-2C9.12 2.5 8 3.62 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4c1.38 0 2.5-1.12 2.5-2.5S20.38 11 19 11V7c0-1.1-.9-2-2-2h-4c0-1.38-1.12-2.5-2.5-2.5"}),"ExtensionOutlined"),w={fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}},b={Belépő:e.jsx(Ie,{sx:w}),Kiegészítő:e.jsx(ve,{sx:w})},Ae=()=>{const[u,H]=n.useState([]),[f,F]=n.useState([]),[_,h]=n.useState(!0),[y,g]=n.useState(null),[x,l]=n.useState(!1),[p,Q]=n.useState(null),[j,T]=n.useState([]),[C,D]=n.useState([]),[E,X]=n.useState(null),[L,Z]=n.useState(""),[R,ee]=he.useState(!1),I=t=>{Q(t)},te=t=>{T(o=>{if(t.category==="Belépő"){if(o.some(r=>r.category==="Belépő"))return o}else if(o.some(r=>r.ticketId===t.ticketId))return o;return[...o,t]})},oe=t=>{D(o=>o.some(r=>r.admissionId===t.admissionId)?o:[...o,t])},P=t=>{"ticketId"in t?T(o=>o.filter(r=>r.ticketId!==t.ticketId)):D(o=>o.filter(r=>r.admissionId!==t.admissionId))},re=()=>{const t=j.reduce((r,s)=>r+s.price,0),o=C.reduce((r,s)=>r+s.price,0);return t+o};if(n.useEffect(()=>{(async()=>{const o=localStorage.getItem("token");if(!o){console.error("No token found. Redirecting to login..."),l(!0);return}try{const r=z(o);if(!r||r.role!=="Admin"&&r.role!=="TicketAssistant"){console.error("Unauthorized access: Admin or TicketAssistant role required"),l(!0);return}if(!await je()){console.error("Invalid token. Redirecting to login..."),l(!0);return}await be();const a=m.get("https://localhost:5000/api/Tickets",{headers:{Authorization:`Bearer ${o}`}}),ue=m.get("https://localhost:5000/api/Admissions",{headers:{Authorization:`Bearer ${o}`}});Promise.all([a,ue]).then(([v,A])=>{Array.isArray(v.data)?H(v.data):console.error("Hibás API válasz: nem tömb",v.data),Array.isArray(A.data)?F(A.data):console.error("Hibás API válasz: nem tömb",A.data),l(!1),h(!1)})}catch(r){console.error("Error during token validation or data fetching:",r),l(!0),h(!1)}})()},[]),x)return localStorage.setItem("isUnauthorizedRedirect","true"),window.location.href="/",null;if(n.useEffect(()=>{const t=localStorage.getItem("token"),o=m.get("https://localhost:5000/api/Tickets",{headers:{Authorization:`Bearer ${t}`}}),r=m.get("https://localhost:5000/api/Admissions",{headers:{Authorization:`Bearer ${t}`}});Promise.all([o,r]).then(([s,a])=>{Array.isArray(s.data)?H(s.data):console.error("Hibás API válasz: nem tömb",s.data),Array.isArray(a.data)?F(a.data):console.error("Hibás API válasz: nem tömb",a.data),Array.isArray(s.data)||console.error("Hibás API válasz: nem tömb",s.data),Array.isArray(a.data)||console.error("Hibás API válasz: nem tömb",a.data),h(!1)}).catch(s=>{console.error("Hiba történt:",s),s.response&&s.response.status===403&&!x?l(!0):g(s.message),h(!1)})},[x]),x)return localStorage.setItem("isUnauthorizedRedirect","true"),setTimeout(()=>{window.location.href="/"},0);if(_)return e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(xe,{size:120,sx:{color:"#bfa181"}})});if(y)return e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx($,{open:!!y,autoHideDuration:6e3,onClose:()=>{g(null),window.location.href="/"},children:e.jsx(K,{onClose:()=>{g(null),window.location.href="/"},severity:"error",variant:"filled",sx:{width:"100%"},children:"Hiba történt az adatok betöltése közben!"})})});var se=f.length;const ne=(()=>{const t=[];for(let o=0;o<u.length;o++){const r=u[o].category;t.includes(r)||t.push(r)}for(let o=0;o<se;o++){const r=f[o].category;t.includes(r)||t.push(r)}return t})().filter(t=>t!=="Egyéb"),ie=u.some(t=>t.category==="Egyéb"),ae=p?u.filter(t=>t.category===p):u,de=p?f.filter(t=>t.category===p):f,le=()=>{const t=localStorage.getItem("token");let o=null;t&&(o=z(t));const r={cardId:E,name:L,createdBy:(o==null?void 0:o.EmployeeId)||"",isActive:!0,ticketsIds:j.map(s=>({ticketId:s.ticketId})),admissions:C.map(s=>({admissionId:s.admissionId}))};m.post("https://localhost:5000/api/Customers",r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).catch(s=>{console.error("Error creating customer:",s),g(s.message)}).finally(()=>{h(!1)})},N=(t,o)=>{o!=="clickaway"&&(ee(!1),setTimeout(()=>{window.location.reload()},300))},ce=j.some(t=>t.category==="Belépő");return e.jsx(e.Fragment,{children:e.jsxs(i,{display:"flex",height:"calc(100vh - 64px)",flexDirection:{xs:"column",md:"row"},children:[e.jsx(i,{sx:{display:{xs:"none",sm:"none",md:"none",lg:"flex"},flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"center",md:"flex-start"},alignItems:"flex-start",p:2,width:{xs:"90%",md:"auto"},minWidth:{md:50},mb:{xs:2,md:0},m:2,height:"90%",backgroundColor:"#202938"},children:e.jsxs(O,{direction:{xs:"row",md:"column"},spacing:2,children:[e.jsx(d,{onClick:()=>I(null),children:e.jsx(ge,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}}})}),ne.map(t=>e.jsx(d,{onClick:()=>I(t),sx:{iconStyle:w},children:b[t]},t)),e.jsx(d,{onClick:()=>I("Egyéb"),disabled:!ie,sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}},children:b.Egyéb})]})}),e.jsx(i,{mb:{xs:2,md:3},width:{xs:"90%",md:"70%",lg:"40%",xl:"30%"},display:"flex",justifyContent:{xs:"center",md:"flex-start"},sx:{height:"93%",p:2},children:e.jsxs(k,{sx:{width:{xs:"100%",md:"100%"},height:"100%",backgroundColor:"#202938",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:"Rendelés",subheader:e.jsxs(e.Fragment,{children:[`Összesen: ${re()} Ft`,e.jsx(i,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(W,{required:!0,id:"standard-required",label:"Kártyazonosító",variant:"standard",value:E||"",onChange:t=>X(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6"},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"}}})}),e.jsx(i,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(W,{required:!0,id:"standard-required",label:"Teljes név",variant:"standard",value:L,onChange:t=>Z(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6"},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"}}})})]}),sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"},"& .MuiCardHeader-title":{color:"#e7e6dd"}}}),e.jsx(i,{sx:{flex:1,overflowY:"auto",maxHeight:"550px",padding:1,marginLeft:2},children:e.jsxs(me,{dense:!0,children:[j.map((t,o)=>e.jsxs(V,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>P(t),children:e.jsx(U,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(q,{children:b[t.category]}),e.jsxs(c,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.ticketName," ",e.jsx("br",{})," ",t.price," Ft"]})]},o)),C.map((t,o)=>e.jsxs(V,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>P(t),children:e.jsx(U,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(q,{children:b[t.category]}),e.jsxs(c,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.admissionName," ",e.jsx("br",{})," ",t.price," ","Ft"]})]},o))]})}),e.jsxs(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"center",paddingBottom:2},children:[e.jsx(Ce,{variant:"contained",endIcon:e.jsx(pe,{}),sx:{m:2,backgroundColor:"#BFA181",width:"80%","&.Mui-disabled":{backgroundColor:"#9e9386",color:"#d5d6d6"}},onClick:le,disabled:!ce,children:"Jegyfoglalás"}),e.jsx($,{open:R&&!y&&!x,autoHideDuration:6e3,onClose:N,children:e.jsx(K,{onClose:N,severity:"success",variant:"filled",sx:{width:"100%"},children:"Sikeres jegyvásárlás!"})})]})]})}),e.jsx(i,{display:"flex",flexDirection:"column",flexGrow:1,ml:{md:3},width:"100%",children:e.jsx(i,{sx:{height:"100%",overflowY:"scroll"},children:e.jsxs(O,{direction:"row",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",sm:"flex-start"},margin:2,children:[ae.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.ticketName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(G,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(J,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(c,{mb:2,children:t.description}),e.jsx(i,{sx:{mt:"auto"},children:e.jsxs(c,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>te(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx(Y,{sx:{fontSize:35}})})})]},t.ticketId)),de.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.admissionName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(G,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(J,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(c,{mb:2,children:t.description}),e.jsx(i,{sx:{mt:"auto"},children:e.jsxs(c,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>oe(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx(Y,{sx:{fontSize:35}})})})]},t.admissionId))]})})})]})})},ke=z(localStorage.getItem("token")).role;fe.createRoot(document.getElementById("root")).render(e.jsxs(e.Fragment,{children:[e.jsx(ye,{role:ke}),e.jsx(Ae,{})]}));
