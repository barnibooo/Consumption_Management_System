import{n as M,j as e,r as n,R as fe,e as s,C as pe,I as d,L as ge,T as a,h as je,p as v,f as Ce}from"./AuthService-D1aEyyWh.js";import{S as V,A as ye,L as N,a as O,D as q}from"./DeleteOutlineOutlined-B2dG6W8x.js";import{S as be}from"./Send-CTj9Mk2s.js";import{p as B,r as Ie,N as ve}from"./RefreshService-BkjTwjQ-.js";import{S as R,A as U}from"./Snackbar-D43d_GBE.js";import{C as k}from"./Card-CQ9FsSn_.js";import{a as S,C as A}from"./CardHeader-DGYPRWYL.js";import{T as P}from"./TextField-B7QlOAzT.js";import{B as ke}from"./Button-CRJhtSgO.js";import{C as K}from"./CardMedia-D7Asrf_x.js";import{C as W}from"./CardContent-CoE-aqRQ.js";import"./Select-Bkp5DD7O.js";const $=M(e.jsx("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4l-3.87 7H8.53L4.27 2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7z"}),"AddShoppingCartOutlined"),Se=M(e.jsx("path",{d:"M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2m-2-1.46c-1.19.69-2 1.99-2 3.46s.81 2.77 2 3.46V18H4v-2.54c1.19-.69 2-1.99 2-3.46 0-1.48-.8-2.77-1.99-3.46L4 6h16zM11 15h2v2h-2zm0-4h2v2h-2zm0-4h2v2h-2z"}),"ConfirmationNumberOutlined"),Ae=M(e.jsx("path",{d:"M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38S5.76 9.8 4.01 9.12L4 7h6V5c0-.28.22-.5.5-.5m0-2C9.12 2.5 8 3.62 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4c1.38 0 2.5-1.12 2.5-2.5S20.38 11 19 11V7c0-1.1-.9-2-2-2h-4c0-1.38-1.12-2.5-2.5-2.5"}),"ExtensionOutlined"),w={fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}},G=document.createElement("style");G.textContent=`
  body {
    background-color: #0f1827;
    color: #d5d6d6;
    margin: 0;
    padding: 0;
  }
`;document.head.appendChild(G);const p={Belépő:e.jsx(Se,{sx:w}),Kiegészítő:e.jsx(Ae,{sx:w})},Be=()=>{const[l,J]=n.useState([]),[u,Y]=n.useState([]),[_,g]=n.useState(!0),[j,C]=n.useState(null),[y,c]=n.useState(!1),[h,Q]=n.useState(null),[x,z]=n.useState([]),[b,F]=n.useState([]),[m,X]=n.useState(null),[f,Z]=n.useState(""),[ee,T]=fe.useState(!1),I=t=>{Q(t)},te=t=>{z(o=>{if(t.category==="Belépő"){if(o.some(r=>r.category==="Belépő"))return o}else if(o.some(r=>r.ticketId===t.ticketId))return o;return[...o,t]})},oe=t=>{F(o=>o.some(r=>r.admissionId===t.admissionId)?o:[...o,t])},H=t=>{"ticketId"in t?z(o=>o.filter(r=>r.ticketId!==t.ticketId)):F(o=>o.filter(r=>r.admissionId!==t.admissionId))},re=()=>{const t=x.reduce((r,i)=>r+i.price,0),o=b.reduce((r,i)=>r+i.price,0);return t+o};if(n.useEffect(()=>{(async()=>{const o=localStorage.getItem("token");if(!o){c(!0);return}try{const r=B(o);if(!r||r.role!=="Admin"&&r.role!=="TicketAssistant"){c(!0);return}if(!await je()){c(!0);return}await Ie();const xe=v.get("https://localhost:5000/api/Tickets",{headers:{Authorization:`Bearer ${o}`}}),me=v.get("https://localhost:5000/api/Admissions",{headers:{Authorization:`Bearer ${o}`}});Promise.all([xe,me]).then(([E,L])=>{Array.isArray(E.data)&&J(E.data),Array.isArray(L.data)&&Y(L.data),c(!1),g(!1)})}catch{c(!0),g(!1)}})()},[]),y)return localStorage.setItem("isUnauthorizedRedirect","true"),window.location.href="/",null;if(y)return localStorage.setItem("isUnauthorizedRedirect","true"),setTimeout(()=>{window.location.href="/"},0);if(_)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(pe,{size:120,sx:{color:"#bfa181"}})});if(j)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(R,{open:!!j,autoHideDuration:6e3,onClose:()=>{C(null),window.location.href="/"},children:e.jsx(U,{onClose:()=>{C(null),window.location.href="/"},severity:"error",variant:"filled",sx:{width:"100%"},children:"Hiba történt az adatok betöltése közben!"})})});var se=u.length;const ne=(()=>{const t=[];for(let o=0;o<l.length;o++){const r=l[o].category;t.includes(r)||t.push(r)}for(let o=0;o<se;o++){const r=u[o].category;t.includes(r)||t.push(r)}return t})().filter(t=>t!=="Egyéb"),ie=l.some(t=>t.category==="Egyéb"),de=h?l.filter(t=>t.category===h):l,ae=h?u.filter(t=>t.category===h):u,le=()=>{const t=localStorage.getItem("token");let o=null;t&&(o=B(t));const r={cardId:m,name:f,createdBy:(o==null?void 0:o.EmployeeId)||"",isActive:!0,ticketsIds:x.map(i=>({ticketId:i.ticketId})),admissions:b.map(i=>({admissionId:i.admissionId}))};v.post("https://localhost:5000/api/Customers",r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{ce()}).catch(i=>{C(i.message)}).finally(()=>{g(!1)})},ce=()=>{T(!0)},D=(t,o)=>{o!=="clickaway"&&(T(!1),setTimeout(()=>{window.location.reload()},300))},ue=x.some(t=>t.category==="Belépő"),he=()=>ue&&m&&m.trim()!==""&&f&&f.trim()!=="";return e.jsx(e.Fragment,{children:e.jsxs(s,{display:"flex",height:"calc(100vh - 64px)",flexDirection:{xs:"column",md:"row"},children:[e.jsx(s,{sx:{display:{xs:"none",sm:"none",md:"none",lg:"flex"},flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"center",md:"flex-start"},alignItems:"flex-start",p:2,width:{xs:"90%",md:"auto"},minWidth:{md:50},mb:{xs:2,md:0},m:2,height:"90%",backgroundColor:"#202938"},children:e.jsxs(V,{direction:{xs:"row",md:"column"},spacing:2,children:[e.jsx(d,{onClick:()=>I(null),children:e.jsx(ye,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}}})}),ne.map(t=>e.jsx(d,{onClick:()=>I(t),sx:{iconStyle:w},children:p[t]},t)),e.jsx(d,{onClick:()=>I("Egyéb"),disabled:!ie,sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}},children:p.Egyéb})]})}),e.jsx(s,{mb:{xs:2,md:3},width:{xs:"90%",md:"70%",lg:"40%",xl:"30%"},display:"flex",justifyContent:{xs:"center",md:"flex-start"},sx:{height:"93%",p:2},children:e.jsxs(k,{sx:{width:{xs:"100%",md:"100%"},height:"100%",backgroundColor:"#202938",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:"Rendelés",subheader:e.jsxs(e.Fragment,{children:[`Összesen: ${re()} Ft`,e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(P,{required:!0,id:"standard-required",label:"Kártyazonosító",variant:"standard",value:m||"",onChange:t=>X(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6","&.Mui-focused":{color:"#d5d6d6"}},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"},marginTop:2}})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(P,{required:!0,id:"standard-required",label:"Teljes név",variant:"standard",value:f,onChange:t=>Z(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6","&.Mui-focused":{color:"#d5d6d6"}},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"},marginTop:2}})})]}),sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"},"& .MuiCardHeader-title":{color:"#e7e6dd"}}}),e.jsx(s,{sx:{flex:1,overflowY:"auto",maxHeight:"550px",padding:1,marginLeft:2},children:e.jsxs(ge,{dense:!0,children:[x.map((t,o)=>e.jsxs(N,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>H(t),children:e.jsx(q,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(O,{children:p[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.ticketName," ",e.jsx("br",{})," ",t.price," Ft"]})]},o)),b.map((t,o)=>e.jsxs(N,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>H(t),children:e.jsx(q,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(O,{children:p[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.admissionName," ",e.jsx("br",{})," ",t.price," ","Ft"]})]},o))]})}),e.jsxs(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"center",paddingBottom:2},children:[e.jsx(ke,{variant:"contained",endIcon:e.jsx(be,{}),sx:{m:2,backgroundColor:"#BFA181",width:"80%","&.Mui-disabled":{backgroundColor:"#9e9386",color:"#d5d6d6"}},onClick:le,disabled:!he(),children:"Jegyfoglalás"}),e.jsx(R,{open:ee&&!j&&!y,autoHideDuration:6e3,onClose:D,children:e.jsx(U,{onClose:D,severity:"success",variant:"filled",sx:{width:"100%"},children:"Sikeres jegyvásárlás!"})})]})]})}),e.jsx(s,{display:"flex",flexDirection:"column",flexGrow:1,ml:{md:3},width:"100%",children:e.jsx(s,{sx:{height:"100%",overflowY:"scroll"},children:e.jsxs(V,{direction:"row",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",sm:"flex-start"},margin:2,children:[de.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.ticketName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(K,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(W,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>te(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx($,{sx:{fontSize:35}})})})]},t.ticketId)),ae.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.admissionName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(K,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(W,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>oe(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx($,{sx:{fontSize:35}})})})]},t.admissionId))]})})})]})})},we=B(localStorage.getItem("token")).role;Ce.createRoot(document.getElementById("root")).render(e.jsxs(e.Fragment,{children:[e.jsx(ve,{role:we}),e.jsx(Be,{})]}));
