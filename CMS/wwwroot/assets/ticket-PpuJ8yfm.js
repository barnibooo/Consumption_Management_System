import{n as z,j as e,r as i,R as fe,e as s,C as ge,I as d,L as pe,T as a,h as je,p as k,f as Ce}from"./AuthService-D1aEyyWh.js";import{S as N,A as ye,L as O,a as q,D as R}from"./DeleteOutlineOutlined-B2dG6W8x.js";import{S as be}from"./Send-CTj9Mk2s.js";import{p as w,r as Ie,N as ve}from"./RefreshService-BkjTwjQ-.js";import{S as U,A as P}from"./Snackbar-D43d_GBE.js";import{C as S}from"./Card-CQ9FsSn_.js";import{a as A,C as B}from"./CardHeader-DGYPRWYL.js";import{T as K}from"./TextField-B7QlOAzT.js";import{B as ke}from"./Button-CRJhtSgO.js";import{C as W}from"./CardMedia-D7Asrf_x.js";import{C as $}from"./CardContent-CoE-aqRQ.js";import"./Select-Bkp5DD7O.js";const G=z(e.jsx("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4l-3.87 7H8.53L4.27 2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7z"}),"AddShoppingCartOutlined"),Se=z(e.jsx("path",{d:"M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2m-2-1.46c-1.19.69-2 1.99-2 3.46s.81 2.77 2 3.46V18H4v-2.54c1.19-.69 2-1.99 2-3.46 0-1.48-.8-2.77-1.99-3.46L4 6h16zM11 15h2v2h-2zm0-4h2v2h-2zm0-4h2v2h-2z"}),"ConfirmationNumberOutlined"),Ae=z(e.jsx("path",{d:"M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38S5.76 9.8 4.01 9.12L4 7h6V5c0-.28.22-.5.5-.5m0-2C9.12 2.5 8 3.62 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4c1.38 0 2.5-1.12 2.5-2.5S20.38 11 19 11V7c0-1.1-.9-2-2-2h-4c0-1.38-1.12-2.5-2.5-2.5"}),"ExtensionOutlined"),M={fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}},J=document.createElement("style");J.textContent=`
  body {
    background-color: #0f1827;
    color: #d5d6d6;
    margin: 0;
    padding: 0;
  }
`;document.head.appendChild(J);const C={Belépő:e.jsx(Se,{sx:M}),Kiegészítő:e.jsx(Ae,{sx:M})},Be=()=>{const[l,Y]=i.useState([]),[u,_]=i.useState([]),[Q,y]=i.useState(!0),[h,x]=i.useState(null),[b,c]=i.useState(!1),[m,X]=i.useState(null),[f,F]=i.useState([]),[I,T]=i.useState([]),[g,Z]=i.useState(null),[p,ee]=i.useState(""),[te,H]=fe.useState(!1),v=t=>{X(t)},oe=t=>{F(o=>{if(t.category==="Belépő"){if(o.some(r=>r.category==="Belépő"))return o}else if(o.some(r=>r.ticketId===t.ticketId))return o;return[...o,t]})},re=t=>{T(o=>o.some(r=>r.admissionId===t.admissionId)?o:[...o,t])},D=t=>{"ticketId"in t?F(o=>o.filter(r=>r.ticketId!==t.ticketId)):T(o=>o.filter(r=>r.admissionId!==t.admissionId))},se=()=>{const t=f.reduce((r,n)=>r+n.price,0),o=I.reduce((r,n)=>r+n.price,0);return t+o};if(i.useEffect(()=>{(async()=>{const o=localStorage.getItem("token");if(!o){c(!0);return}try{const r=w(o);if(!r||r.role!=="Admin"&&r.role!=="TicketAssistant"){c(!0);return}if(!await je()){c(!0);return}await Ie();const j=k.get("https://localhost:5000/api/Tickets",{headers:{Authorization:`Bearer ${o}`}}),me=k.get("https://localhost:5000/api/Admissions",{headers:{Authorization:`Bearer ${o}`}});Promise.all([j,me]).then(([L,V])=>{Array.isArray(L.data)&&Y(L.data),Array.isArray(V.data)&&_(V.data),c(!1),y(!1)})}catch{c(!0),y(!1)}})()},[]),b)return localStorage.setItem("isUnauthorizedRedirect","true"),window.location.href="/",null;if(b)return localStorage.setItem("isUnauthorizedRedirect","true"),setTimeout(()=>{window.location.href="/"},0);if(Q)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(ge,{size:120,sx:{color:"#bfa181"}})});if(h)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(U,{open:!!h,autoHideDuration:6e3,onClose:()=>{x(null),window.location.href="/ticket"},children:e.jsx(P,{onClose:()=>{x(null),window.location.href="/ticket"},severity:"error",variant:"filled",sx:{width:"100%"},children:h})})});var ne=u.length;const ie=(()=>{const t=[];for(let o=0;o<l.length;o++){const r=l[o].category;t.includes(r)||t.push(r)}for(let o=0;o<ne;o++){const r=u[o].category;t.includes(r)||t.push(r)}return t})().filter(t=>t!=="Egyéb"),de=l.some(t=>t.category==="Egyéb"),ae=m?l.filter(t=>t.category===m):l,le=m?u.filter(t=>t.category===m):u,ce=()=>{const t=localStorage.getItem("token");let o=null;t&&(o=w(t));const r={cardId:g,name:p,createdBy:(o==null?void 0:o.EmployeeId)||"",isActive:!0,ticketsIds:f.map(n=>({ticketId:n.ticketId})),admissions:I.map(n=>({admissionId:n.admissionId}))};k.post("https://localhost:5000/api/Customers",r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{ue()}).catch(n=>{var j;console.log(n),((j=n.response)==null?void 0:j.status)===409?x("Az adott kártya már aktív, így a jegyvásárlás nem lehetséges!"):x("Hiba történt a rendelés leadása során!")}).finally(()=>{y(!1)})},ue=()=>{H(!0)},E=(t,o)=>{o!=="clickaway"&&(H(!1),setTimeout(()=>{window.location.reload()},300))},he=f.some(t=>t.category==="Belépő"),xe=()=>he&&g&&g.trim()!==""&&p&&p.trim()!=="";return e.jsx(e.Fragment,{children:e.jsxs(s,{display:"flex",height:"calc(100vh - 64px)",flexDirection:{xs:"column",md:"row"},children:[e.jsx(s,{sx:{display:{xs:"none",sm:"none",md:"none",lg:"flex"},flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"center",md:"flex-start"},alignItems:"flex-start",p:2,width:{xs:"90%",md:"auto"},minWidth:{md:50},mb:{xs:2,md:0},m:2,height:"90%",backgroundColor:"#202938"},children:e.jsxs(N,{direction:{xs:"row",md:"column"},spacing:2,children:[e.jsx(d,{onClick:()=>v(null),children:e.jsx(ye,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}}})}),ie.map(t=>e.jsx(d,{onClick:()=>v(t),sx:{iconStyle:M},children:C[t]},t)),e.jsx(d,{onClick:()=>v("Egyéb"),disabled:!de,sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}},children:C.Egyéb})]})}),e.jsx(s,{mb:{xs:2,md:3},width:{xs:"90%",md:"70%",lg:"40%",xl:"30%"},display:"flex",justifyContent:{xs:"center",md:"flex-start"},sx:{height:"93%",p:2},children:e.jsxs(S,{sx:{width:{xs:"100%",md:"100%"},height:"100%",backgroundColor:"#202938",display:"flex",flexDirection:"column"},children:[e.jsx(A,{title:"Rendelés",subheader:e.jsxs(e.Fragment,{children:[`Összesen: ${se()} Ft`,e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(K,{required:!0,id:"standard-required",label:"Kártyazonosító",variant:"standard",value:g||"",onChange:t=>Z(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6","&.Mui-focused":{color:"#d5d6d6"}},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"},marginTop:2}})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(K,{required:!0,id:"standard-required",label:"Teljes név",variant:"standard",value:p,onChange:t=>ee(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6","&.Mui-focused":{color:"#d5d6d6"}},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"},marginTop:2}})})]}),sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"},"& .MuiCardHeader-title":{color:"#e7e6dd"}}}),e.jsx(s,{sx:{flex:1,overflowY:"auto",maxHeight:"550px",padding:1,marginLeft:2},children:e.jsxs(pe,{dense:!0,children:[f.map((t,o)=>e.jsxs(O,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>D(t),children:e.jsx(R,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(q,{children:C[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.ticketName," ",e.jsx("br",{})," ",t.price," Ft"]})]},o)),I.map((t,o)=>e.jsxs(O,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>D(t),children:e.jsx(R,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(q,{children:C[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.admissionName," ",e.jsx("br",{})," ",t.price," ","Ft"]})]},o))]})}),e.jsxs(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"center",paddingBottom:2},children:[e.jsx(ke,{variant:"contained",endIcon:e.jsx(be,{}),sx:{m:2,backgroundColor:"#BFA181",width:"80%","&.Mui-disabled":{backgroundColor:"#9e9386",color:"#d5d6d6"}},onClick:ce,disabled:!xe(),children:"Jegyfoglalás"}),e.jsx(U,{open:te&&!h&&!b,autoHideDuration:6e3,onClose:E,children:e.jsx(P,{onClose:E,severity:"success",variant:"filled",sx:{width:"100%"},children:"Sikeres jegyvásárlás!"})})]})]})}),e.jsx(s,{display:"flex",flexDirection:"column",flexGrow:1,ml:{md:3},width:"100%",children:e.jsx(s,{sx:{height:"100%",overflowY:"scroll"},children:e.jsxs(N,{direction:"row",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",sm:"flex-start"},margin:2,children:[ae.map(t=>e.jsxs(S,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(A,{title:t.ticketName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(W,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs($,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>oe(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx(G,{sx:{fontSize:35}})})})]},t.ticketId)),le.map(t=>e.jsxs(S,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(A,{title:t.admissionName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(W,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs($,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(B,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>re(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx(G,{sx:{fontSize:35}})})})]},t.admissionId))]})})})]})})},we=w(localStorage.getItem("token")).role;Ce.createRoot(document.getElementById("root")).render(e.jsxs(e.Fragment,{children:[e.jsx(ve,{role:we}),e.jsx(Be,{})]}));
