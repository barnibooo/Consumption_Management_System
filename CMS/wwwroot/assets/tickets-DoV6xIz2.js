import{l as M,j as e,r as i,R as xe,e as s,C as me,L as fe,T as a,n as v,f as ge}from"./index-DW2RJM_L.js";import{S as N,A as pe,L as O,a as V,D as q}from"./DeleteOutlineOutlined-BKd7d45w.js";import{S as je}from"./Send-COCKoMwb.js";import{c as Ce}from"./AuthService-CMdpMXi0.js";import{r as be}from"./RefreshService-BElCRExB.js";import{I as d,p as B,N as ye}from"./Navbar-BavKYrQN.js";import{S as P,A as U}from"./Snackbar-BoVZBEip.js";import{C as k}from"./Card-B3esABxY.js";import{C as S}from"./CardHeader-D3kGs5sr.js";import{T as R}from"./TextField-B_SISyHb.js";import{C as A}from"./CardActions-CR4ggJcr.js";import{B as Ie}from"./Button-L5L-jXUd.js";import{C as K}from"./CardMedia-Datqsumh.js";import{C as W}from"./CardContent-BSubk8B7.js";import"./Select-CssrkscS.js";const $=M(e.jsx("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4l-3.87 7H8.53L4.27 2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7z"}),"AddShoppingCartOutlined"),ve=M(e.jsx("path",{d:"M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2m-2-1.46c-1.19.69-2 1.99-2 3.46s.81 2.77 2 3.46V18H4v-2.54c1.19-.69 2-1.99 2-3.46 0-1.48-.8-2.77-1.99-3.46L4 6h16zM11 15h2v2h-2zm0-4h2v2h-2zm0-4h2v2h-2z"}),"ConfirmationNumberOutlined"),ke=M(e.jsx("path",{d:"M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38S5.76 9.8 4.01 9.12L4 7h6V5c0-.28.22-.5.5-.5m0-2C9.12 2.5 8 3.62 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4c1.38 0 2.5-1.12 2.5-2.5S20.38 11 19 11V7c0-1.1-.9-2-2-2h-4c0-1.38-1.12-2.5-2.5-2.5"}),"ExtensionOutlined"),w={fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}},m={Belépő:e.jsx(ve,{sx:w}),Kiegészítő:e.jsx(ke,{sx:w})},Se=()=>{const[l,G]=i.useState([]),[u,J]=i.useState([]),[Y,f]=i.useState(!0),[g,p]=i.useState(null),[j,c]=i.useState(!1),[h,_]=i.useState(null),[x,z]=i.useState([]),[C,F]=i.useState([]),[H,Q]=i.useState(null),[T,X]=i.useState(""),[Z,D]=xe.useState(!1),b=t=>{_(t)},ee=t=>{z(o=>{if(t.category==="Belépő"){if(o.some(r=>r.category==="Belépő"))return o}else if(o.some(r=>r.ticketId===t.ticketId))return o;return[...o,t]})},te=t=>{F(o=>o.some(r=>r.admissionId===t.admissionId)?o:[...o,t])},E=t=>{"ticketId"in t?z(o=>o.filter(r=>r.ticketId!==t.ticketId)):F(o=>o.filter(r=>r.admissionId!==t.admissionId))},oe=()=>{const t=x.reduce((r,n)=>r+n.price,0),o=C.reduce((r,n)=>r+n.price,0);return t+o};if(i.useEffect(()=>{(async()=>{const o=localStorage.getItem("token");if(!o){console.error("No token found. Redirecting to login..."),c(!0);return}try{const r=B(o);if(!r||r.role!=="Admin"&&r.role!=="TicketAssistant"){console.error("Unauthorized access: Admin or TicketAssistant role required"),c(!0);return}if(!await Ce()){console.error("Invalid token. Redirecting to login..."),c(!0);return}await be();const ue=v.get("https://localhost:5000/api/Tickets",{headers:{Authorization:`Bearer ${o}`}}),he=v.get("https://localhost:5000/api/Admissions",{headers:{Authorization:`Bearer ${o}`}});Promise.all([ue,he]).then(([y,I])=>{Array.isArray(y.data)?G(y.data):console.error("Hibás API válasz: nem tömb",y.data),Array.isArray(I.data)?J(I.data):console.error("Hibás API válasz: nem tömb",I.data),c(!1),f(!1)})}catch(r){console.error("Error during token validation or data fetching:",r),c(!0),f(!1)}})()},[]),j)return localStorage.setItem("isUnauthorizedRedirect","true"),window.location.href="/",null;if(j)return localStorage.setItem("isUnauthorizedRedirect","true"),setTimeout(()=>{window.location.href="/"},0);if(Y)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(me,{size:120,sx:{color:"#bfa181"}})});if(g)return e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(P,{open:!!g,autoHideDuration:6e3,onClose:()=>{p(null),window.location.href="/"},children:e.jsx(U,{onClose:()=>{p(null),window.location.href="/"},severity:"error",variant:"filled",sx:{width:"100%"},children:"Hiba történt az adatok betöltése közben!"})})});var re=u.length;const se=(()=>{const t=[];for(let o=0;o<l.length;o++){const r=l[o].category;t.includes(r)||t.push(r)}for(let o=0;o<re;o++){const r=u[o].category;t.includes(r)||t.push(r)}return t})().filter(t=>t!=="Egyéb"),ne=l.some(t=>t.category==="Egyéb"),ie=h?l.filter(t=>t.category===h):l,de=h?u.filter(t=>t.category===h):u,ae=()=>{const t=localStorage.getItem("token");let o=null;t&&(o=B(t));const r={cardId:H,name:T,createdBy:(o==null?void 0:o.EmployeeId)||"",isActive:!0,ticketsIds:x.map(n=>({ticketId:n.ticketId})),admissions:C.map(n=>({admissionId:n.admissionId}))};v.post("https://localhost:5000/api/Customers",r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).then(()=>{le()}).catch(n=>{console.error("Error creating customer:",n),p(n.message)}).finally(()=>{f(!1)})},le=()=>{D(!0)},L=(t,o)=>{o!=="clickaway"&&(D(!1),setTimeout(()=>{window.location.reload()},300))},ce=x.some(t=>t.category==="Belépő");return e.jsx(e.Fragment,{children:e.jsxs(s,{display:"flex",height:"calc(100vh - 64px)",flexDirection:{xs:"column",md:"row"},children:[e.jsx(s,{sx:{display:{xs:"none",sm:"none",md:"none",lg:"flex"},flexDirection:{xs:"column",md:"row"},justifyContent:{xs:"center",md:"flex-start"},alignItems:"flex-start",p:2,width:{xs:"90%",md:"auto"},minWidth:{md:50},mb:{xs:2,md:0},m:2,height:"90%",backgroundColor:"#202938"},children:e.jsxs(N,{direction:{xs:"row",md:"column"},spacing:2,children:[e.jsx(d,{onClick:()=>b(null),children:e.jsx(pe,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}}})}),se.map(t=>e.jsx(d,{onClick:()=>b(t),sx:{iconStyle:w},children:m[t]},t)),e.jsx(d,{onClick:()=>b("Egyéb"),disabled:!ne,sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"},"&:active":{color:"#BFA181"}},children:m.Egyéb})]})}),e.jsx(s,{mb:{xs:2,md:3},width:{xs:"90%",md:"70%",lg:"40%",xl:"30%"},display:"flex",justifyContent:{xs:"center",md:"flex-start"},sx:{height:"93%",p:2},children:e.jsxs(k,{sx:{width:{xs:"100%",md:"100%"},height:"100%",backgroundColor:"#202938",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:"Rendelés",subheader:e.jsxs(e.Fragment,{children:[`Összesen: ${oe()} Ft`,e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(R,{required:!0,id:"standard-required",label:"Kártyazonosító",variant:"standard",value:H||"",onChange:t=>Q(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6"},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"}}})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(R,{required:!0,id:"standard-required",label:"Teljes név",variant:"standard",value:T,onChange:t=>X(t.target.value),sx:{width:"80%","& .MuiInputBase-root":{color:"#d5d6d6"},"& .MuiInputLabel-root":{color:"#d5d6d6"},"& .MuiInput-underline:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:hover:before":{borderBottomColor:"#d5d6d6"},"& .MuiInput-underline:after":{borderBottomColor:"#d5d6d6"},"& .Mui-focused .MuiInputLabel-root":{color:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:before":{borderBottomColor:"#d5d6d6 !important"},"& .Mui-focused .MuiInput-underline:after":{borderBottomColor:"#d5d6d6 !important"}}})})]}),sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"},"& .MuiCardHeader-title":{color:"#e7e6dd"}}}),e.jsx(s,{sx:{flex:1,overflowY:"auto",maxHeight:"550px",padding:1,marginLeft:2},children:e.jsxs(fe,{dense:!0,children:[x.map((t,o)=>e.jsxs(O,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>E(t),children:e.jsx(q,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(V,{children:m[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.ticketName," ",e.jsx("br",{})," ",t.price," Ft"]})]},o)),C.map((t,o)=>e.jsxs(O,{secondaryAction:e.jsx(d,{edge:"end","aria-label":"delete",onClick:()=>E(t),children:e.jsx(q,{sx:{fontSize:35,color:"#d5d6d6","&:hover":{color:"#BFA181"}}})}),children:[e.jsx(V,{children:m[t.category]}),e.jsxs(a,{variant:"body2",color:"#e7e6dd",fontSize:16,children:[t.admissionName," ",e.jsx("br",{})," ",t.price," ","Ft"]})]},o))]})}),e.jsxs(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"center",paddingBottom:2},children:[e.jsx(Ie,{variant:"contained",endIcon:e.jsx(je,{}),sx:{m:2,backgroundColor:"#BFA181",width:"80%","&.Mui-disabled":{backgroundColor:"#9e9386",color:"#d5d6d6"}},onClick:ae,disabled:!ce,children:"Jegyfoglalás"}),e.jsx(P,{open:Z&&!g&&!j,autoHideDuration:6e3,onClose:L,children:e.jsx(U,{onClose:L,severity:"success",variant:"filled",sx:{width:"100%"},children:"Sikeres jegyvásárlás!"})})]})]})}),e.jsx(s,{display:"flex",flexDirection:"column",flexGrow:1,ml:{md:3},width:"100%",children:e.jsx(s,{sx:{height:"100%",overflowY:"scroll"},children:e.jsxs(N,{direction:"row",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",sm:"flex-start"},margin:2,children:[ie.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.ticketName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(K,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(W,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>ee(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx($,{sx:{fontSize:35}})})})]},t.ticketId)),de.map(t=>e.jsxs(k,{sx:{width:{xs:"100%",sm:"45%",md:"90%",lg:"45%",xl:"30%"},background:"#202938",color:"#d5d6d6",display:"flex",flexDirection:"column"},children:[e.jsx(S,{title:t.admissionName,subheader:t.category,sx:{"& .MuiCardHeader-subheader":{color:"#d5d6d6"}}}),e.jsx(K,{component:"img",height:"200",image:t.imagePath,alt:"Kép"}),e.jsxs(W,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(a,{mb:2,children:t.description}),e.jsx(s,{sx:{mt:"auto"},children:e.jsxs(a,{fontWeight:"bold",children:[t.price," Ft"]})})]}),e.jsx(A,{disableSpacing:!0,sx:{mt:"auto",justifyContent:"flex-start"},children:e.jsx(d,{onClick:()=>te(t),sx:{color:"#d5d6d6",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#BFA181"}},children:e.jsx($,{sx:{fontSize:35}})})})]},t.admissionId))]})})})]})})},Ae=B(localStorage.getItem("token")).role;ge.createRoot(document.getElementById("root")).render(e.jsxs(e.Fragment,{children:[e.jsx(ye,{role:Ae}),e.jsx(Se,{})]}));
